<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Total Functions</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css" as="style"><link rel="preload" href="/real-world-functional-programming-book/assets/js/app.ad1bfc28.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/2.774c5d42.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/16.8f2a7f1e.js" as="script"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/10.94dd7f8c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/11.698c5c4f.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/12.192a3ae6.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/13.8386adfa.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/14.25c778d2.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/15.22df2363.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/17.96c3770c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/18.53fa9806.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/19.ddf2a677.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/20.010d7881.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/21.d4385542.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/22.63c29633.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/23.0b95ec99.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/24.030da7fd.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/25.6075c853.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/26.6e33666c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/27.52ebbb9a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/28.480e5398.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/29.44aa6890.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/3.ce6d7c8e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/30.36ffc316.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/31.3e451e47.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/32.03e0d851.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/33.15f7a19e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/34.1962de40.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/35.9a9c5557.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/36.649f4a76.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/37.360dc873.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/38.4369e41d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/39.7b6c045d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/4.80637c28.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/40.929f8cf3.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/41.5630fa3d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/42.5eed66fd.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/43.66d1dc46.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/44.b329c0c4.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/45.c2ff687a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/46.70dbd72b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/47.e725e0a3.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/48.7b884d6a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/49.f3176d54.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/5.f3fe2246.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/50.1f0d0491.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/51.505f0293.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/52.cec6ae98.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/53.f676af80.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/54.90c93f46.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/55.12ba710b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/56.c95224bc.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/57.15f55d22.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/58.5dd45008.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/59.67287c0b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/6.26e4ee07.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/60.60191211.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/7.a98c49df.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/8.74213919.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/9.997a717b.js">
    <link rel="stylesheet" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/real-world-functional-programming-book/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/real-world-functional-programming-book/" class="sidebar-link">Inroduction</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part1/" class="sidebar-heading clickable router-link-active"><span>Part 1: Pure Functions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part2/" class="sidebar-heading clickable"><span>Part 2: Getting and Setting Data</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part3/" class="sidebar-heading clickable"><span>Part 3: List Comprehensions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part4/" class="sidebar-heading clickable"><span>Part 4: Curry and Partial Applications</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part5/" class="sidebar-heading clickable"><span>Part 5: Composition</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part6/" class="sidebar-heading clickable"><span>Part 6: Algebraic Data Types</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part7/" class="sidebar-heading clickable"><span>Part 7: Optics</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part8/" class="sidebar-heading clickable"><span>Part 8: Debugging</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part9/" class="sidebar-heading clickable"><span>Part 9: Testing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="total-functions"><a href="#total-functions" class="header-anchor">#</a> Total Functions</h1> <p>A total function is a pure function that works with all inputs. They often depend on how the language and operators, like <code>+</code> work. If you create a function that adds numbers, it'll work with a <code>Number</code>, <code>String</code>, <code>Function</code>, some random <code>class</code>, anything! Typically they are a lot easier to make in strongly typed languages because the compiler will ensure your function that adds 2 <code>Number</code>s never gets a String input, or ensures you use <code>+</code> instead of <code>++</code> by accident.</p> <p>In dynamic languages, you have to do a lot more work to validate your inputs and take a whitelist approach to types. Considering that JavaScript, Python, and Lua are communities built largely upon libraries, you can't guarantee that someone will be accepting of different kinds of inputs, and if you accidentally send the wrong one, they'll tell you that vs. some bonkers stack trace.</p> <h2 id="functions-that-never-fail"><a href="#functions-that-never-fail" class="header-anchor">#</a> Functions That Never Fail</h2> <p>Pure functions and immutability are great to produce code that is more predictable. However, without a compiler and/or runtime verification, you can still have them throw an exception, or just be &quot;wrong&quot; (what the math people call &quot;incorrect&quot;). Total functions can help you get your code immune to runtime exceptions as possible without the need of a compiler. They can even help a bit on the &quot;correctness&quot; of your code.</p> <h2 id="how-can-a-pure-function-still-throw"><a href="#how-can-a-pure-function-still-throw" class="header-anchor">#</a> How Can a Pure Function Still Throw?</h2> <p>If we're building some functions to validate what the user types in a text input, we need to ensure they didn't leave it blank, so we'll count the length of a <code>String</code> using a pure function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">notBlank</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span>
    str<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre></div><p>If the user types &quot;cow&quot;, it'll return <code>true</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">notBlank</span><span class="token punctuation">(</span><span class="token string">'cow'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>If the user types nothing, it'll return <code>false</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">notBlank</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>... but what happens if we don't have an initialized value, or we use this function where she could accidentally get something other than a <code>String</code>?</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">notBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// TypeError: Cannot read property 'length' of undefined</span>
</code></pre></div><p>We should instead check for the <code>String</code> data type using Lodash' <a href="https://lodash.com/docs/4.17.11#isString" target="_blank" rel="noopener noreferrer">isString<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> predicate:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">notBlank</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span>
    <span class="token function">isString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre></div><p>Now, the function is more total; it can accept just about any input now and still work:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">notBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">notBlank</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h2 id="how-can-a-pure-function-be-incorrect"><a href="#how-can-a-pure-function-be-incorrect" class="header-anchor">#</a> How Can a Pure Function Be Incorrect?</h2> <p>Let's validate a USA phone/mobile number:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">parsePhoneNumber</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">isNumber</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">String</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">10</span>
</code></pre></div><p>Then try it out with a valid phone number:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">parsePhoneNumber</span><span class="token punctuation">(</span><span class="token string">'1235559876'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">parsePhoneNumber</span><span class="token punctuation">(</span><span class="token string">'555'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">parsePhoneNumber</span><span class="token punctuation">(</span><span class="token number">1235559876</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">parsePhoneNumber</span><span class="token punctuation">(</span><span class="token number">555</span><span class="token punctuation">)</span>
</code></pre></div><p>... but what if the phone number is valid:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">parsePhoneNumber</span><span class="token punctuation">(</span><span class="token string">'(123) 555-9876'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>While the function is pure and somewhat total... the return value is still incorrect; that's a valid phone number.</p> <p>Total functions will help a lot with the types, and a bit with the correctness. These benefits compound (get more powerful) when you start composing/combining them together into larger functions. They come with the cost of additional maintenance, and unit/property tests, and additional hard work.</p> <h2 id="problem-adding-random-things"><a href="#problem-adding-random-things" class="header-anchor">#</a> Problem: Adding Random Things</h2> <p>Dynamic languages pass random things everywhere. We attempt to not pass random things when we write code and unit tests, but the dynamism is a double edged sword: power of flexibility, yet bad things happen when you get what you weren't expecting.</p> <p>For example, here's our original pure function from <a href="/real-world-functional-programming-book/part1/input_output_side_effects.html">Chapter 1: Pure Functions</a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>It follows all pure function rules of same input, same output, and no side effects.</p> <p>However, what happens if we add things that aren't numbers?</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'how now brown cow'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token string">'busy child'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 'Error: how now brown cow[object Object]'</span>
</code></pre></div><p>Um, ok... that isn't really helpful. Probably not what the developer wanted, nor expected. Worse, once you start composing this with other functions in <code>flow</code>/<code>compose</code> or <code>Promise</code>, the chain can get corrupted. You may get parsing results or errors that don't make immediate sense with little hint as to where the problem originated. This is when you start longing for stack traces again when debugging functional code, or even... ðŸ˜° strong types!</p> <h2 id="solution-solving-with-types"><a href="#solution-solving-with-types" class="header-anchor">#</a> Solution: Solving With Types</h2> <p>One way to solve this is to use types. With just a little metadata added by you the developer, compilers can read and understand your code, and find your errors in nanoseconds. They can even offer fixes, or sometimes automatically fix. <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, an open source language &amp; compiler started by Microsoft and open source, is one such language.</p> <p>Rewriting our function in TypeScript, we explicitly say &quot;Yo, this function takes 2 numbers, and returns a number.&quot; This is enough for the TypeScript compiler, <code>tsc</code> to verify your inputs.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token punctuation">(</span> a<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b
</code></pre></div><p>Before we can even run the code in TypeScript, we have to compile it to JavaScript. However, instantly, TypeScript shows us an error with our 2nd add:</p> <blockquote><p>Argument of type 'Error' is not assignable to parameter of type 'number'.`</p></blockquote> <p>In English, that's:</p> <blockquote><p>&quot;The <code>add</code> function only takes a <code>Number</code> for the first argument, but you are passing an <code>Error</code>. You're not allowed to do that. Change the first parameter to a <code>Number</code>.&quot;</p></blockquote> <p>As your functions grow in number, size, and you start composing them, it can be really hard to keep track of all the types going around, and ensuring that you're always getting the correct type. If another developer is using your code, will they get a meaningful error if your function chokes on a weird type it wasn't expecting? These kinds of problems types can help like TypeScript, <a href="https://flow.org/" target="_blank" rel="noopener noreferrer">Flow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="http://elm-lang.org/" target="_blank" rel="noopener noreferrer">Elm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, and <a href="http://www.purescript.org/" target="_blank" rel="noopener noreferrer">PureScript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>The downside here is libraries. Just because you're using a transpilation/compilation solution doesn't mean your consumers are. While you can use TypeScript and publish a library to <code>npm</code> doesn't mean those who install it will be using TypeScript. They could just be using raw JavaScript, or Webpack with just ES6. Also, not all data parsing libraries are strict like <a href="https://avro.apache.org/docs/current/" target="_blank" rel="noopener noreferrer">AVRO<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>/<a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener noreferrer">Protobuf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to ensure the types they parse are &quot;guaranteed a <code>Number</code> once you get it to use for your add function&quot; at runtime. That said, even a little can help, it just won't make your functions total for everyone.</p> <h2 id="solution-solving-with-manual-native-runtime-validation"><a href="#solution-solving-with-manual-native-runtime-validation" class="header-anchor">#</a> Solution: Solving With Manual, Native Runtime Validation</h2> <p>Another solution is to do your own runtime type evaluation. If you implement a whitelist, then you only ensure the types you're expecting get through, otherwise you tell the caller of the function it failed, and you give them as much detail about what they passed in so they can have an easier time debugging. We started this with our <code>isString</code> usage in the first example for <code>notBlank</code>.</p> <p>Without using any libraries and just raw JavaScript, we'll return our own result following the multiple return value model that Go, Lua, and Python follow (see <a href="/real-world-functional-programming-book/part1/part1/error_quest.html">Part 1: Error Quest</a>):</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isNumber</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> o <span class="token operator">===</span> <span class="token string">'number'</span>
<span class="token keyword">const</span> <span class="token function-variable function">addNumbers</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">(</span> <span class="token function">isNumber</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNumber</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token punctuation">{</span>ok<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> a <span class="token operator">+</span> b<span class="token punctuation">}</span>
    <span class="token punctuation">:</span> <span class="token punctuation">{</span>ok<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Either a or b aren't Numbers. a: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, b: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><p>There are some edge cases with our <code>isNumber</code>; <code>1</code> and <code>Number(1)</code> will be <code>true</code>, but <code>new Number(1)</code> will be false, but it's &quot;mostly&quot; total just like some functions are &quot;mostly&quot; pure.</p> <p>Now calling it:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// { ok: true, data: 3 }</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'how now brown cow'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token string">'busy child'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// { ok: false,</span>
<span class="token comment">//   error: Error: Either a or b aren't Numbers. a: Error: how now brown cow, b: [object Object]</span>
<span class="token comment">// ...</span>
</code></pre></div><p>Now the function is mostly total. It'll literally accept ANYTHING and let you know if <code>add</code> worked or not. Where pure functions are dependable to build applications on, total functions are a level above that and nigh unbreakable.</p> <h2 id="solution-solving-with-manual-folktale-runtime-validation"><a href="#solution-solving-with-manual-folktale-runtime-validation" class="header-anchor">#</a> Solution: Solving With Manual, Folktale Runtime Validation</h2> <p>The challenge with the above is that <code>isNumber</code>, while a predicate, isn't very composable when you have a bunch of arguments that are different kinds. Also, some types have multiple rules above them such as product or Union types and so you'll run multiple predicates against them.</p> <p>Folktale <code>Validation</code>s work great here. Let's take our load website pure function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">loadWebsite</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> failure</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            err
            <span class="token operator">?</span> <span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span>res<span class="token punctuation">,</span> body<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>... and make it total using Folktale <code>Validation</code>s. We'll first need a bunch of predicates to ensure our <code>request</code> and <code>url</code> are acceptable types.</p> <h3 id="request-shape"><a href="#request-shape" class="header-anchor">#</a> Request Shape</h3> <p>Let's ensure our <code>request</code> &quot;looks the right shape&quot;; has the expected methods and properties we'd want <code>request</code> to have. If it has those, it's probably a <code>request</code> and the developer/us didn't screw up. We'll rely heavily on Lodash' base predicates. Given <code>request</code> uses Object Oriented Programming, we'll use <code>hasIn</code> to be safe when looking for properties as opposed to <code>has</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">,</span> hasIn<span class="token punctuation">,</span> isFunction <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">hasGetFunction</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasPostFunction</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasInitParams</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">hasIn</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'initParams'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="url-shape"><a href="#url-shape" class="header-anchor">#</a> URL Shape</h3> <p>For our <code>url</code>, we'll ensure she's a <code>String</code>, and looks like a URL:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">,</span> isString<span class="token punctuation">,</span> some <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">legitString</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasHTTP</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasHTTPS</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasLocalhost</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasDots</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">const</span> <span class="token function-variable function">legitURL</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">legitString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">some</span><span class="token punctuation">(</span>
        <span class="token punctuation">[</span>
            hasHTTP<span class="token punctuation">,</span>
            hasHTTPS<span class="token punctuation">,</span>
            hasLocalhost<span class="token punctuation">,</span>
            hasDots
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token parameter">predicate</span> <span class="token operator">=&gt;</span> <span class="token function">predicate</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>A quick test of the URL one:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">legitURL</span><span class="token punctuation">(</span><span class="token string">'http://jessewarden.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">legitURL</span><span class="token punctuation">(</span><span class="token string">'https://google.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">legitURL</span><span class="token punctuation">(</span><span class="token string">'localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">legitURL</span><span class="token punctuation">(</span><span class="token string">'192.168.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">legitURL</span><span class="token punctuation">(</span><span class="token string">'chicken pot pie'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h3 id="request-validations"><a href="#request-validations" class="header-anchor">#</a> Request Validations</h3> <p>Now we'll create some <code>Validation</code>s that use those predicates for request:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Validation <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/validation'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Success<span class="token punctuation">,</span> Failure <span class="token punctuation">}</span> <span class="token operator">=</span> Validation

<span class="token keyword">const</span> <span class="token function-variable function">validRequestGet</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">hasGetFunction</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your request doesn't have a get function, you sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequestPost</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">hasPostFunction</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your request doesn't have a post function, you sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequestInitParams</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">hasInitParams</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your request doesn't have an initParams function, you sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequest</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">validRequestGet</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">validRequestPost</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">validRequestInitParams</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="url-validations"><a href="#url-validations" class="header-anchor">#</a> URL Validations</h3> <p>Now the <code>url</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">validURL</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">legitURL</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The URL doesn't appear to be a valid url containing http, https, localhost, or dots for an IP Address. You sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="combining-it-all-together"><a href="#combining-it-all-together" class="header-anchor">#</a> Combining it All Together</h3> <p>Combining those together to make our function total:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">loadWebsite</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> failure</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token function">validRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">validURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">Failure</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">failure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">Success</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
                request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    err
                    <span class="token operator">?</span> <span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                    <span class="token punctuation">:</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span>res<span class="token punctuation">,</span> body<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>When we call it with good parameters, we get our expected result:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">loadWebsite</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'http://jessewarden.com'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> body <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// html: &lt;!DOCTYPE html&gt;</span>
<span class="token comment">// &lt;html</span>
</code></pre></div><p>If we mess up the <code>url</code>, however:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">loadWebsite</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ðŸ®'</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
<span class="token comment">// error: Error: The URL doesn't appear to be a valid url containing http, https, localhost, or dots for an IP Address. You sent: ðŸ®</span>
<span class="token comment">// ...</span>
</code></pre></div><p>Same for giving a bogus <code>request</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get
<span class="token function">loadWebsite</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">'http://jessewarden.com'</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
<span class="token comment">// error: Error: Your request doesn't have a get function, you sent: function (uri, options, callback) {</span>
<span class="token comment">//     var params = initParams(uri, options, callback)</span>
<span class="token comment">//     params.method = method</span>
<span class="token comment">//     return request(params, params.callback)</span>
<span class="token comment">//   }, Your request doesn't have a post function, you sent: function (uri, options, callback) {</span>
<span class="token comment">//     var params = initParams(uri, options, callback)</span>
<span class="token comment">//     params.method = method</span>
<span class="token comment">//     return request(params, params.callback)</span>
<span class="token comment">//   }, Your request doesn't have an initParams function, you sent: function (uri, options, callback) {</span>
<span class="token comment">//     var params = initParams(uri, options, callback)</span>
<span class="token comment">//     params.method = method</span>
<span class="token comment">//     return request(params, params.callback)</span>
<span class="token comment">//   }</span>
<span class="token comment">//   ...</span>
</code></pre></div><p>You can see you can now pass whatever you want, and only the good gets through. Instead of relying on 3rd party code and libraries that don't have the best error handling, you only use those errors if bad data somehow makes it passed your total function validations. Anything you can do using <code>Validation</code>s to ensure yourself or another developer doesn't have to think when reading an error message is super helpful and time saving. That, and you can avoid strange errors that can occur when third party libraries/code aren't as good as you are in handling various types.</p> <p>The final code is:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> <span class="token punctuation">{</span>isString<span class="token punctuation">,</span> some<span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">,</span> hasIn<span class="token punctuation">,</span> isFunction <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Validation <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/validation'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Success<span class="token punctuation">,</span> Failure <span class="token punctuation">}</span> <span class="token operator">=</span> Validation

<span class="token comment">// -- Predicates ---------------------</span>

<span class="token keyword">const</span> <span class="token function-variable function">hasGetFunction</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasPostFunction</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasInitParams</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">hasIn</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'initParams'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">legitString</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasHTTP</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasHTTPS</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasLocalhost</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasDots</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span> <span class="token function">isString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">const</span> <span class="token function-variable function">legitURL</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">legitString</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">some</span><span class="token punctuation">(</span>
        <span class="token punctuation">[</span>
            hasHTTP<span class="token punctuation">,</span>
            hasHTTPS<span class="token punctuation">,</span>
            hasLocalhost<span class="token punctuation">,</span>
            hasDots
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token parameter">predicate</span> <span class="token operator">=&gt;</span> <span class="token function">predicate</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

<span class="token comment">// -- Validations ---------------------</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequestGet</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">hasGetFunction</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your request doesn't have a get function, you sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequestPost</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">hasPostFunction</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your request doesn't have a post function, you sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequestInitParams</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">hasInitParams</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your request doesn't have an initParams function, you sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validRequest</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">validRequestGet</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">validRequestPost</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">validRequestInitParams</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">validURL</span> <span class="token operator">=</span> <span class="token parameter">o</span> <span class="token operator">=&gt;</span>
    <span class="token function">legitURL</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">Success</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The URL doesn't appear to be a valid url containing http, https, localhost, or dots for an IP Address. You sent: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>o<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">const</span> <span class="token function-variable function">loadWebsite</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> failure</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token function">validRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">validURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">Failure</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">failure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">Success</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
                request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    err
                    <span class="token operator">?</span> <span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                    <span class="token punctuation">:</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span>res<span class="token punctuation">,</span> body<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><h3 id="unit-test-side-note"><a href="#unit-test-side-note" class="header-anchor">#</a> Unit Test Side Note</h3> <p>Note now that we're checking for all 3 methods on <code>request</code>, this may fail unit tests that stub only request with a get function, i.e.:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// this will fail since stub won't pass validation</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'request.get should work'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> requestStub <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'yay'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">loadWebsite</span><span class="token punctuation">(</span>requestStub<span class="token punctuation">,</span> <span class="token string">'http://jessewarden.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>eventually<span class="token punctuation">.</span>be<span class="token punctuation">.</span>fulfilled<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="conclusions"><a href="#conclusions" class="header-anchor">#</a> Conclusions</h2> <p>Total functions are pure functions that accept all inputs. The pro's are enhanced error handling if done manually, less unknown errors from other code, and overall more dependable functions. The error messages, especially from API response errors, are really helpful for consumers of your code.</p> <p>The con's are they can require more unit tests to ensure you've handled the edge cases. This is before you even start writing property tests via <a href="https://github.com/jsverify/jsverify" target="_blank" rel="noopener noreferrer">jsverify<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Like unit test stubs, they will expect a certain implementation shape, and so your stubs have to be more thorough to match the implementation. i.e. &quot;A <code>get</code> is good enough, right? Wait... we're not even testing <code>post</code>, why do I need to implement a blank function for it on the stub?&quot;</p> <p>Also, developers who are not using types don't like how verbose they are to debug and modify. We've take a 1 line pure function and turned it into 70 lines and 14 additional functions just to make it reasonably total. While you could just unit test the <code>add</code> function itself, you'll end up writing unit tests for the others anyway to ensure you've written your predicates correctly, which in turn leads to a lot of more unit tests. Over time, these tests may not be maintained since it's hard for future developers to understand why the private functions of your module are being so thoroughly tested vs. just the public implementation.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/real-world-functional-programming-book/assets/js/app.ad1bfc28.js" defer></script><script src="/real-world-functional-programming-book/assets/js/2.774c5d42.js" defer></script><script src="/real-world-functional-programming-book/assets/js/16.8f2a7f1e.js" defer></script>
  </body>
</html>
