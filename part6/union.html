<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Union</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css" as="style"><link rel="preload" href="/real-world-functional-programming-book/assets/js/app.ad1bfc28.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/2.774c5d42.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/47.e725e0a3.js" as="script"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/10.94dd7f8c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/11.698c5c4f.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/12.192a3ae6.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/13.8386adfa.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/14.25c778d2.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/15.22df2363.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/16.8f2a7f1e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/17.96c3770c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/18.53fa9806.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/19.ddf2a677.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/20.010d7881.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/21.d4385542.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/22.63c29633.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/23.0b95ec99.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/24.030da7fd.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/25.6075c853.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/26.6e33666c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/27.52ebbb9a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/28.480e5398.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/29.44aa6890.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/3.ce6d7c8e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/30.36ffc316.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/31.3e451e47.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/32.03e0d851.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/33.15f7a19e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/34.1962de40.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/35.9a9c5557.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/36.649f4a76.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/37.360dc873.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/38.4369e41d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/39.7b6c045d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/4.80637c28.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/40.929f8cf3.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/41.5630fa3d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/42.5eed66fd.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/43.66d1dc46.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/44.b329c0c4.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/45.c2ff687a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/46.70dbd72b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/48.7b884d6a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/49.f3176d54.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/5.f3fe2246.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/50.1f0d0491.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/51.505f0293.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/52.cec6ae98.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/53.f676af80.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/54.90c93f46.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/55.12ba710b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/56.c95224bc.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/57.15f55d22.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/58.5dd45008.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/59.67287c0b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/6.26e4ee07.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/60.60191211.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/7.a98c49df.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/8.74213919.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/9.997a717b.js">
    <link rel="stylesheet" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/real-world-functional-programming-book/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/real-world-functional-programming-book/" class="sidebar-link">Inroduction</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part1/" class="sidebar-heading clickable"><span>Part 1: Pure Functions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part2/" class="sidebar-heading clickable"><span>Part 2: Getting and Setting Data</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part3/" class="sidebar-heading clickable"><span>Part 3: List Comprehensions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part4/" class="sidebar-heading clickable"><span>Part 4: Curry and Partial Applications</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part5/" class="sidebar-heading clickable"><span>Part 5: Composition</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part6/" class="sidebar-heading clickable router-link-active open"><span>Part 6: Algebraic Data Types</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/real-world-functional-programming-book/part6/maybe.html" class="sidebar-link">/part6/maybe.html</a></li><li><a href="/real-world-functional-programming-book/part6/validation.html" class="sidebar-link">Validation</a></li><li><a href="/real-world-functional-programming-book/part6/result.html" class="sidebar-link">Result</a></li><li><a href="/real-world-functional-programming-book/part6/union.html" class="active sidebar-link">Union</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#scalars-products-and-unions" class="sidebar-link">Scalars, Products, and Unions</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#basic-custom-example" class="sidebar-link">Basic Custom Example</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#more-than-2" class="sidebar-link">More Than 2</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#what-could-possibly-go-wrong" class="sidebar-link">What Could Possibly Go Wrong?</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#did-it-work-or-not" class="sidebar-link">Did it Work or Not?</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#matchwith-vs-type-checking" class="sidebar-link">matchWith vs. Type Checking</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#boolean-replacements" class="sidebar-link">Boolean Replacements</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#multiple-booleans-in-asynchronous-redux" class="sidebar-link">Multiple Booleans in Asynchronous Redux</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part6/union.html#conclusions" class="sidebar-link">Conclusions</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part7/" class="sidebar-heading clickable"><span>Part 7: Optics</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part8/" class="sidebar-heading clickable"><span>Part 8: Debugging</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part9/" class="sidebar-heading clickable"><span>Part 9: Testing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="union"><a href="#union" class="header-anchor">#</a> Union</h1> <p>A Union is a bunch of types in one value. You use them to represent many possible types. They're also a great replacement for one or many Booleans. Union types have a special ability called matching that uses a pure function and removes the need for using <code>if</code> statements. You've seen this briefly used in the <a href="/real-world-functional-programming-book/part6/validation.html">Validation</a> and <a href="/real-world-functional-programming-book/part6/result.html">Result</a> sections and we'll expound on it here.</p> <h2 id="scalars-products-and-unions"><a href="#scalars-products-and-unions" class="header-anchor">#</a> Scalars, Products, and Unions</h2> <p>A String  is a <strong>scalar</strong> type; <code>&quot;cow&quot;</code> is always <code>&quot;cow&quot;</code> and completely different from <code>&quot;goat&quot;</code>.</p> <p>An Object is a <strong>product</strong> type; it's the combination of many types into one like:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Dat Moo Moo'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">'üêÆ'</span><span class="token punctuation">,</span> food<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'hay'</span><span class="token punctuation">,</span> <span class="token string">'grass'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

That </span><span class="token template-punctuation string">`</span></span>Object<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> contains 2 </span><span class="token template-punctuation string">`</span></span>String<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">s, a </span><span class="token template-punctuation string">`</span></span>Number<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">, and an </span><span class="token template-punctuation string">`</span></span>Array<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.

A **union** type combines those products together. If you've read this book in order, you've already seen 3 Union types: </span><span class="token template-punctuation string">`</span></span>Maybe<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">, </span><span class="token template-punctuation string">`</span></span>Validation<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> and </span><span class="token template-punctuation string">`</span></span>Result<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">. A </span><span class="token template-punctuation string">`</span></span>Maybe<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> is either a </span><span class="token template-punctuation string">`</span></span>Just<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> or </span><span class="token template-punctuation string">`</span></span>Nothing<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">. Both are distinct types like </span><span class="token template-punctuation string">`</span></span>Array<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">, and they have similar methods, but represent completely different things. The </span><span class="token template-punctuation string">`</span></span>Maybe<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> marries the 2 into 1 type.

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>javascript
<span class="token keyword">const</span> union <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/adt/union/union'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Maybe <span class="token operator">=</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token string">'Maybe'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">Just</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token function">Nothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>// [jwarden 3.10.2019] TODO/FIXME: Dude, what happened above? Why are you writing a book in code comments?</p> <h2 id="basic-custom-example"><a href="#basic-custom-example" class="header-anchor">#</a> Basic Custom Example</h2> <p>Below, we're searching a list of users by ID. If we find one, we want the user it found. If it didn't find one, we want a clear message saying so, and what ID we used to search for:</p> <p>// [jwarden 3.10.2019] TODO/FIXME: break this down into smaller chunks</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> find <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> union<span class="token punctuation">,</span> derivations<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/adt/union'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> FindUserResult <span class="token operator">=</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token string">'FindUserResult'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">IDNotFound</span><span class="token punctuation">(</span><span class="token parameter">userID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> userID <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">derive</span><span class="token punctuation">(</span>derivations<span class="token punctuation">.</span>debugRepresentation<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> User<span class="token punctuation">,</span> IDNotFound <span class="token punctuation">}</span> <span class="token operator">=</span> FindUserResult

<span class="token keyword">const</span> <span class="token function-variable function">findUserByID</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">users<span class="token punctuation">,</span> userID</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">find</span><span class="token punctuation">(</span>
        <span class="token parameter">user</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id <span class="token operator">===</span> userID<span class="token punctuation">,</span>
        users
    <span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">findUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">users<span class="token punctuation">,</span> userID</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">findUserByID</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> userID<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token function">findUserByID</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> userID<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token function">IDNotFound</span><span class="token punctuation">(</span>userID<span class="token punctuation">)</span>

<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Jesse'</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Brandy'</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token function">findUser</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span>
<span class="token comment">// FindUserResult.User({ user: { name: &quot;Brandy&quot;, id: 2 } })</span>

<span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token function">findUser</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
<span class="token comment">// FindUserResult.IDNotFound({ userID: 5 })</span>
</code></pre></div><p>Similar to <code>Maybe</code>, just more specific. Note the <code>.derive(derivations.debugRepresentation)</code> is so when we <code>console.log</code> it out, it doesn't just print as a normal looking <code>Object</code>.</p> <h2 id="more-than-2"><a href="#more-than-2" class="header-anchor">#</a> More Than 2</h2> <p>However, not all sub-types have to have 2 like <code>Maybe</code>, <code>Validation</code>, <code>Result</code>, and <code>FindUserResult</code>:</p> <p>For example, if you're using Kafka or Amazon Kinesis to build a log monitoring application, you'll often be a stream processor. You'll listen to a series of input streams, parse and aggregate the data, and then output it on another stream. Given it's from a multitude of applications, you'll be getting many different types of messages, and each one contains different information, and in turn requires a separate parsing operation.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Message <span class="token operator">=</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token string">'Message'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">Log</span><span class="token punctuation">(</span><span class="token parameter">log</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> log <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">DatadogMetric</span><span class="token punctuation">(</span><span class="token parameter">metric</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> metric <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">ManualAlert</span><span class="token punctuation">(</span><span class="token parameter">alert</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> alert <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">NetworkInfo</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> source<span class="token punctuation">,</span> info <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="what-could-possibly-go-wrong"><a href="#what-could-possibly-go-wrong" class="header-anchor">#</a> What Could Possibly Go Wrong?</h2> <p>Union types are great for modeling errors. They help you know more clearly what went wrong, embed debug information for future you, while keeping things pure and composeable.</p> <p>// [jwarden 3.10.2019] TODO/FIXME: Using the throttling example, may result in less code.</p> <p>For example, if you want to upload an Excel file in this application we built at work, there are a lot of things to go wrong. You wouldn't know that, though, from reading this code:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">uploadFile</span> <span class="token operator">=</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token parameter">form</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> failure</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>form<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            err
            <span class="token operator">?</span> <span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>If you give it a <code>request</code> and some multi-part form data, she'll attempt to upload. If it works, great, you'll get the server response in the <code>Promise.then</code>. If it fails, you'll get an what went wrong in the <code>Promise.catch</code>. Cool right?</p> <p>Well, no. This is an application for users who aren't always tech savvy and manage a lot of money. Any visual indication as to what went wrong can help in customer support calls and various escalations to higher level support, like the developers who wrote the code. If the developers use good error handling and the designer on the team creates a good error screen with well written copy, the developers hopefully won't ever get a support call. Additionally, any information a user might do to help fix the problem themselves can stop those calls from even happening.</p> <p>So what can go wrong? There are known knowns, and known unknowns:</p> <ul><li>your session can expire if you login and leave the web application open for 20 minutes without doing anything. Either the http status is 302, OR it's 200 but the URL is not the URL you posted too because you have a proxy in front of your API layer that makes strange decisions.</li> <li>we can't figure out who you are from the session</li> <li>you attempt to upload a file that isn't an Excel file</li> <li>you attempt to upload an Excel file that has macros in it</li> <li>you attempt to upload a virus</li> <li>you upload more than 1 file, and the first file is fine, but the other one(s) have 1 of the problems listed above</li> <li>the email took too long to send a successful email response or failed</li> <li>the messaging service that lets you know the status of your file either failed or couldn't be reached in time</li></ul> <p>Let's model that into a custom Union type:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> FileUploadResult <span class="token operator">=</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token string">'FileUploadResult'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">SessionExpired</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> httpStatusCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> httpStatusCode <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">NotLoggedIn</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> httpStatusCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> httpStatusCode <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">UnsupportedFileType</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">ExcelMacros</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Virus</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">EmailFailed</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> file <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">MessageFailed</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error<span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token function">Success</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> file <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Notice all are errors, and many hold more information about the error, like the http status code vs. just looking around in the message String. The last one indicates a successful file upload and contains the file it uploaded.</p> <p>Now that we have our type, we can use it to be more clear as to what went wrong or right by returning that from the <code>Promise</code>. We won't ever fail the <code>Promise</code>, though, we'll just let the caller decide, so we remove the typically success/failure, and just put resolve:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">uploadFile</span> <span class="token operator">=</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token parameter">form</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span>
        request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>form<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">getFileUploadResult</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>Calling it, we can build up String for each error to be clear what went wrong or right:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> uploadResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>fileForm<span class="token punctuation">)</span>

uploadResult<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">SessionExpired</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>error<span class="token punctuation">,</span> httpStatusCode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You've been logged out. http code: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>httpStatusCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">NotLoggedIn</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// let Proxy redirect to login</span>
    <span class="token function-variable function">UnsupportedFileType</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> error<span class="token punctuation">,</span> file<span class="token punctuation">,</span> reason <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">An unsupported file type was uploaded. We only support Excel files with no macros.
file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">ExcelMacros</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> file <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The Excel file you uploaded contained macros. Please remove them and Save As to create a new Excel with the macros removed.
File: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">Virus</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> file <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The Excel file you uploaded was identified as a virus.
virus file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">EmailFailed</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">We failed to email your file successful. Error received: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">MessageFailed</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">We emailed your file successfully, but failed to send a confirmation message. Please manually check your inbox.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">Success</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> file <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Successfully uploaded and emailed your file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="did-it-work-or-not"><a href="#did-it-work-or-not" class="header-anchor">#</a> Did it Work or Not?</h2> <p>If you just want to know if it worked or not, you can simply return a <code>Boolean</code>. The <code>stubTrue</code> and <code>stubFalse</code> functions from lodash &amp; lodash/fp are functions that always return true <code>() =&gt; true</code>, and always return false <code>() =&gt; false</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> stubTrue<span class="token punctuation">,</span> stubFalse <span class="token punctuation">}</span> <span class="token operator">=</span> 
<span class="token keyword">const</span> <span class="token function-variable function">didUploadWork</span> <span class="token operator">=</span> <span class="token parameter">result</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    SessionExpired<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    NotLoggedIn<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    UnsupportedFileType<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    ExcelMacros<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    Virus<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    EmailFailed<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    MessageFailed<span class="token punctuation">:</span> stubFalse<span class="token punctuation">,</span>
    Success<span class="token punctuation">:</span> stubTrue
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">didUploadWork</span><span class="token punctuation">(</span><span class="token function">Success</span><span class="token punctuation">(</span><span class="token string">'some file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">didUploadWork</span><span class="token punctuation">(</span><span class="token function">NotLoggedIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'boom'</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h2 id="matchwith-vs-type-checking"><a href="#matchwith-vs-type-checking" class="header-anchor">#</a> matchWith vs. Type Checking</h2> <p>This style of wrapping complex return values into custom types is used in Object Oriented Programming as well. For example, simplifying a <code>fetch</code> call into 3 possible return values/</p> <p>We got an HTTP status other than 200:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Failed</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> error
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We got a good response, but couldn't parse the JSON:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">JSONParseFailed</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> error
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And a successful response with successful JSON parsing:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Successful</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>You'd then check the type:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">someFetchCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Failed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP call failed:&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result<span class="token punctuation">.</span>error
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">JSONParseFailed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;JSON parsing failed:&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result<span class="token punctuation">.</span>error
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Successful:&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result<span class="token punctuation">.</span>data
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Ranting about the problems with <code>if</code> statements especially without a type system is beyond the scope of this book, so suffice to say:</p> <ol><li>we're not checking specifically for <code>Successful</code>, we just assume if the first too aren't found, it's <code>Successful</code>.</li> <li>If we were missing a type, we'd get a null pointer on <code>result.data</code> trying to access data on a class type that doesn't have it... not really helpful to say why the fetch call did or did not succeed.</li> <li>If we add/remove a type, we have to be careful about ensuring the order of if statements and ensure each case is handled.</li> <li>What do we put for the else if we did specifically check for <code>Successful</code>?</li> <li>We're having to dot access class instances without lenses nor a type checker.</li> <li>You could accidentally forget to return a specific/correct value from the class error / data property.</li> <li>This is Imperative style code in a Functional Programming book, GTFO.</li></ol> <p>Let's change that to a pure function using <code>matchWith</code> and Union a type instead. We'll first define are types like we did in the OOP example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> FetchResult <span class="token operator">=</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token string">'FetchResult'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">Failed</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token function">JSONParseFailed</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token function">Successful</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>And to use it, we just use <code>matchWith</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">someFetchCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span>
    result<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">Failed</span><span class="token punctuation">:</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP call failed:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">JSONParseFailed</span><span class="token punctuation">:</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;JSON parsing failed:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">Successful</span><span class="token punctuation">:</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>If you're not using a typed language like TypeScript or Flow, you can ensure you covered all possible cases with an <code>any</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> any <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/adt/union/union'</span><span class="token punctuation">)</span>

<span class="token function">someFetchCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span>
    result<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>
        <span class="token punctuation">,</span> <span class="token punctuation">[</span>any<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;unknown match.&quot;</span><span class="token punctuation">)</span> <span class="token comment">// might not be error</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Remember, <code>matchWith</code> is a pure function. If you're forced to work with Promises, you can simply return the unboxed values, and the <code>data</code> will go to the <code>then</code> and the <code>error</code>'s will automatically go to the <code>catch</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">...</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span>
    result<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">Failed</span><span class="token punctuation">:</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP call failed:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token operator">||</span> error
        <span class="token punctuation">,</span> <span class="token function-variable function">JSONParseFailed</span><span class="token punctuation">:</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;JSON parsing failed:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token operator">||</span> error
        <span class="token punctuation">,</span> <span class="token function-variable function">Successful</span><span class="token punctuation">:</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">||</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>While I'm not a fan, many love the await/async syntax. If you use Union types as the return value instead of values or <code>Error</code>'s like you do with Promises, you can solve 2 problems:</p> <ol><li>no need for a try/catch</li> <li>allow the consumer to pattern match the result</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">someFetchCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="boolean-replacements"><a href="#boolean-replacements" class="header-anchor">#</a> Boolean Replacements</h2> <p>Jeremy Fairbank covers the problem with Boolean's is his presentation &quot;<a href="https://www.youtube.com/watch?v=6TDKHGtAxeg" target="_blank" rel="noopener noreferrer">Solving the Boolean Identity Crisis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;. The short version is using Booleans, even outside of a type system can cause problems with <code>if</code> statements missing a case, and parameters not really being clear as to what they mean. We'll cover the latter problem.</p> <p>For example, this function call from a game:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">jump</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div><p>Is the <code>true</code> meaning &quot;how high&quot; or &quot;using gravity boots to stick on the celing&quot; or.... what? No clue, so you go read the function definition to figure it out.</p> <p>... vs this one:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">jump</span><span class="token punctuation">(</span>Horizontal<span class="token punctuation">)</span>
</code></pre></div><p>Suddenly it's more clear just by reading the function the first parameter means a horizontal jump vs a vertical one.</p> <p>Before types, you have to check the Boolean value with an if statement:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">jump</span> <span class="token operator">=</span> <span class="token parameter">horizontal</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>horizontal <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// vertical jump</span>
        object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// horizontal jump</span>
        object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>vs. using a Union type:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">jump</span> <span class="token operator">=</span> <span class="token parameter">direction</span> <span class="token operator">=&gt;</span>
    direction<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">Vertical</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
            object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">Horizontal</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
            object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>No need to worry about adding new types of jumps and missing an if else block:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">jump</span> <span class="token operator">=</span> <span class="token parameter">direction</span> <span class="token operator">=&gt;</span>
    direction<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">Vertical</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
            object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">Right</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
            object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">Left</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span>
            object<span class="token punctuation">.</span><span class="token function">applyForce</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object<span class="token punctuation">.</span>y <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="multiple-booleans-in-asynchronous-redux"><a href="#multiple-booleans-in-asynchronous-redux" class="header-anchor">#</a> Multiple Booleans in Asynchronous Redux</h2> <p>Whether you use <a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="noopener noreferrer">sagas<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or <a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener noreferrer">thunks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to handle asynchronous calls in <a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer">Redux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in <a href="https://reactjs.org/" target="_blank" rel="noopener noreferrer">React<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, the UI portion is probably the same.</p> <ol><li>Loading...</li> <li>Successfully got data.</li> <li>Failed to get data, here's the error and what you can do about it.</li></ol> <p>The typical pattern is to create an Object specifically for that <a href="http://jessewarden.com/2012/07/finite-state-machines-in-game-development.html" target="_blank" rel="noopener noreferrer">finite state machine<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that looks like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// loading state</span>
<span class="token punctuation">{</span>
    loading<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">,</span> error <span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And when you successfully got data:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// success state</span>
<span class="token punctuation">{</span>
    loading<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> loggedIn<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">:</span> <span class="token string">'Jesse'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">,</span> error <span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And when it fails:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// error state</span>
<span class="token punctuation">{</span>
    loading<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">,</span> error <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'500 http status code returned.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Creating reducer functions for this is pretty straightforward. However, you can prevent worrying about getting in invalid states such as:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// wait, is this the default?</span>
<span class="token punctuation">{</span>
    loading<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">,</span> error <span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or my favorite:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// &quot;You are figh-ahd!&quot;</span>
<span class="token comment">// &quot;At least you bought me lunch.&quot;</span>
<span class="token comment">// &quot;Guuuuud philosophy... see gud in beehd!&quot;</span>
<span class="token punctuation">{</span>
    loading<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> loggedIn <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">:</span> <span class="token string">'Jesse'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">,</span> error <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'200 http status code returned.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once you start having multiple Booleans, it feels pure and safe having just a few reducer functions ensuring you can't really get into an invalid state. However, it's easier to just use a Union type and not have to worry about it ever happening at all:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> LoginState <span class="token operator">=</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token string">'LoginState'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">Loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token function">Failure</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> error <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token function">Success</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Now for login, your reducer goes from this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">loginReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'login'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>previousState<span class="token punctuation">,</span> loading<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">'loginSuccess'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>previousState<span class="token punctuation">,</span> loading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> action<span class="token punctuation">.</span>data <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">'loginError'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>previousState<span class="token punctuation">,</span> loading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isError<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> action<span class="token punctuation">.</span>error <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            previousState
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">loginReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'login'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token function">Loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">'loginSuccess'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token function">Success</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">'loginError'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token function">Failure</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            previousState
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And instead of your imperative JSX render method looking like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>login<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>login<span class="token punctuation">.</span>isError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>ErrorScreen error<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>login<span class="token punctuation">.</span>error<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>UserProfile user<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>login<span class="token punctuation">.</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can just match against the Union in a more functional way:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token parameter">render</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>login<span class="token punctuation">.</span><span class="token function">matchWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">Loading</span><span class="token punctuation">:</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">Failure</span><span class="token punctuation">:</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>ErrorScreen error<span class="token operator">=</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">,</span> <span class="token function-variable function">Success</span><span class="token punctuation">:</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>UserProfile user<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="conclusions"><a href="#conclusions" class="header-anchor">#</a> Conclusions</h2> <p>Union types are great for modeling errors, or when you have multiple return types. They can represent data or <code>null</code> more specifically than a simple <code>Maybe</code>, and give you more insight into what we wrong than a simple <code>Result.Error</code>. They make functions that use Booleans as parameters more readable to other developers without having to read the function body to understand what the Boolean parameter means as the Union literally has its meaning in its name. That, and no need for if statements which are easy to mess up. For multiple Booleans where you're making smaller state machines, they can help simplify it and ensure only the states you want are capable of being reached.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/real-world-functional-programming-book/part6/result.html" class="prev">Result</a></span> <span class="next"><a href="/real-world-functional-programming-book/part7/isomorphisms.html">Isomorphisms</a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/real-world-functional-programming-book/assets/js/app.ad1bfc28.js" defer></script><script src="/real-world-functional-programming-book/assets/js/2.774c5d42.js" defer></script><script src="/real-world-functional-programming-book/assets/js/47.e725e0a3.js" defer></script>
  </body>
</html>
