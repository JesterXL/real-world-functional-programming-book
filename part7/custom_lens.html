<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating a Custom Lens</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css" as="style"><link rel="preload" href="/real-world-functional-programming-book/assets/js/app.ad1bfc28.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/2.774c5d42.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/51.505f0293.js" as="script"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/10.94dd7f8c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/11.698c5c4f.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/12.192a3ae6.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/13.8386adfa.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/14.25c778d2.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/15.22df2363.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/16.8f2a7f1e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/17.96c3770c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/18.53fa9806.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/19.ddf2a677.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/20.010d7881.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/21.d4385542.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/22.63c29633.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/23.0b95ec99.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/24.030da7fd.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/25.6075c853.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/26.6e33666c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/27.52ebbb9a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/28.480e5398.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/29.44aa6890.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/3.ce6d7c8e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/30.36ffc316.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/31.3e451e47.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/32.03e0d851.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/33.15f7a19e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/34.1962de40.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/35.9a9c5557.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/36.649f4a76.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/37.360dc873.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/38.4369e41d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/39.7b6c045d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/4.80637c28.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/40.929f8cf3.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/41.5630fa3d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/42.5eed66fd.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/43.66d1dc46.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/44.b329c0c4.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/45.c2ff687a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/46.70dbd72b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/47.e725e0a3.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/48.7b884d6a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/49.f3176d54.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/5.f3fe2246.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/50.1f0d0491.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/52.cec6ae98.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/53.f676af80.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/54.90c93f46.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/55.12ba710b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/56.c95224bc.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/57.15f55d22.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/58.5dd45008.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/59.67287c0b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/6.26e4ee07.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/60.60191211.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/7.a98c49df.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/8.74213919.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/9.997a717b.js">
    <link rel="stylesheet" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/real-world-functional-programming-book/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/real-world-functional-programming-book/" class="sidebar-link">Inroduction</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part1/" class="sidebar-heading clickable"><span>Part 1: Pure Functions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part2/" class="sidebar-heading clickable"><span>Part 2: Getting and Setting Data</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part3/" class="sidebar-heading clickable"><span>Part 3: List Comprehensions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part4/" class="sidebar-heading clickable"><span>Part 4: Curry and Partial Applications</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part5/" class="sidebar-heading clickable"><span>Part 5: Composition</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part6/" class="sidebar-heading clickable"><span>Part 6: Algebraic Data Types</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part7/" class="sidebar-heading clickable router-link-active open"><span>Part 7: Optics</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/real-world-functional-programming-book/part7/isomorphisms.html" class="sidebar-link">Isomorphisms</a></li><li><a href="/real-world-functional-programming-book/part7/prisms.html" class="sidebar-link">Prisms</a></li><li><a href="/real-world-functional-programming-book/part7/composing_lenses.html" class="sidebar-link">Composing Lenses</a></li><li><a href="/real-world-functional-programming-book/part7/custom_lens.html" class="active sidebar-link">Creating a Custom Lens</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part7/custom_lens.html#lens-function-getter" class="sidebar-link">Lens Function: Getter</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part7/custom_lens.html#lens-function-setter" class="sidebar-link">Lens Function: Setter</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part7/custom_lens.html#composing-lenses" class="sidebar-link">Composing Lenses</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part7/custom_lens.html#using-our-custom-lens" class="sidebar-link">Using Our Custom Lens</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part7/custom_lens.html#enhancing-our-custom-lens" class="sidebar-link">Enhancing Our Custom Lens</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part8/" class="sidebar-heading clickable"><span>Part 8: Debugging</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part9/" class="sidebar-heading clickable"><span>Part 9: Testing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="creating-a-custom-lens"><a href="#creating-a-custom-lens" class="header-anchor">#</a> Creating a Custom Lens</h1> <p>// [jwarden 3.10.2019] TODO/FIXME: I found this a bit hard to follow coming back after a couple months. We should probably run the code as you write it.</p> <p>Using this basic isomorphism concept and the <code>compose</code> function, you can combine the reading and writing of the file together to its own lens. While a <code>Buffer</code> that comes from reading a file, turned into <code>String</code>, then an <code>Object</code>, then back again is also an isomorphism, we need some information about the original Object so we'll just create a custom lens.</p> <h2 id="lens-function-getter"><a href="#lens-function-getter" class="header-anchor">#</a> Lens Function: Getter</h2> <p>Like <code>iso</code>, a <code>lens</code> function's first parameter is a getter, and the function's signature is basically a <code>map</code> function; take in some data as a single parameter, return some transformed data. The <code>readFileSync</code> is straightforward; if you give it a filename, it'll return the contents of that file, hence we just give it the function as the first parameter:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">,</span> lens <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'focused'</span>

<span class="token keyword">const</span> fileLens <span class="token operator">=</span> <span class="token function">lens</span><span class="token punctuation">(</span>
    readFileSync<span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="lens-function-setter"><a href="#lens-function-setter" class="header-anchor">#</a> Lens Function: Setter</h2> <p>The <code>writeFileSync</code> however takes 2 parameters; the filename and contents, yet returns nothing. If we supply a simple wrapper, pre-filling the 1st parameter:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">,</span> writeFileSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span>

<span class="token keyword">const</span> fileLens <span class="token operator">=</span> <span class="token function">lens</span><span class="token punctuation">(</span>
    readFileSync<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> originalData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'savedgame.json'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>Better, but one problem; the setter part of the lens is supposed to be a <code>map</code> function and return what it set. Since <code>writeFileSync</code> is mainly about side effects, specifically writing the file, it doesn't return anything and throws if it fails. Very imperative and not what we need. Let's modify it and just return the data you wrote for now. Since <code>writeFileSync</code> always returns <code>undefined</code>, the short circuit <code>||</code> will always return <code>data</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fileLens <span class="token operator">=</span> <span class="token function">iso</span><span class="token punctuation">(</span>
    readFileSync<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> originalData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'savedgame.json'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">||</span> data
<span class="token punctuation">)</span>
</code></pre></div><h2 id="composing-lenses"><a href="#composing-lenses" class="header-anchor">#</a> Composing Lenses</h2> <p>Internally, Focused uses its own <code>compose</code> method to combine all the lenses together. Our <code>set</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">set</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span>jsonISO<span class="token punctuation">)</span><span class="token punctuation">.</span>saveDate<span class="token punctuation">,</span> <span class="token operator">...</span>
</code></pre></div><p>Without the proxy syntax could be written as:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token punctuation">,</span> prop<span class="token punctuation">,</span> compose <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'focused'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> lens <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
    jsonISO<span class="token punctuation">,</span>
    <span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'savedDate'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> updated <span class="token operator">=</span> <span class="token keyword">set</span><span class="token punctuation">(</span>lens<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gameState<span class="token punctuation">)</span>
</code></pre></div><p>Let's do that so we can combine our <code>fileLens</code> first, then our <code>jsonISO</code> 2nd:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> readAndParseLens <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  fileLens<span class="token punctuation">,</span>
  jsonISO
<span class="token punctuation">)</span>
</code></pre></div><h2 id="using-our-custom-lens"><a href="#using-our-custom-lens" class="header-anchor">#</a> Using Our Custom Lens</h2> <p>And we can still keep our proxy syntax with <code>savedDate</code>. Notice we give it the filename instead of the <code>gameState</code> as the 3rd parameter:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> updatedString <span class="token operator">=</span> <span class="token keyword">set</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span>readAndParseLens<span class="token punctuation">)</span><span class="token punctuation">.</span>saveDate<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'savedgame.json'</span><span class="token punctuation">)</span>
</code></pre></div><p>Logging out the <code>String</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;saveDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-11-25T21:24:58.726Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;map&quot;</span><span class="token operator">:</span> <span class="token string">&quot;overworld&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chapter&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    ...
</code></pre></div><p>And to verify the side effect of writing the file worked, the contents of the file:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;saveDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-11-25T21:24:58.726Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;map&quot;</span><span class="token operator">:</span> <span class="token string">&quot;overworld&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chapter&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    ...
</code></pre></div><h2 id="enhancing-our-custom-lens"><a href="#enhancing-our-custom-lens" class="header-anchor">#</a> Enhancing Our Custom Lens</h2> <p>When saving games, you have many saved games. We're using our &quot;savedgame.json&quot; as a template, but then writing over it every time. Our custom lens even hardcodes &quot;savegame.json&quot; inside of it. What we want is to have a new filename each time we set the <code>saveDate</code>, and have that be part of the filename to make sorting easier and ensure unique filenames.</p> <p>My kids date hack on various games such as <a href="http://www.animal-crossing.com/" target="_blank" rel="noopener noreferrer">Animal Crossing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>; meaning they manually change the video game console's system clock backwards and forwards so they don't have to wait in the real world. This results in the game rewarding them &quot;earlier&quot; than it should, and allowing them to experience special days whenever they want by travelling to the future in game time. This also means using a date as a filename could have collisions, so we'll enhance our lens to use a unique string from a Universal Unique Identifier via the <a href="https://www.npmjs.com/package/uuid" target="_blank" rel="noopener noreferrer">uuid library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to prevent those collisions. Date hacking should be allowed and shouldn't result in them accidentally overwriting saved games. Although writing files is a side effect, we'll attempt to keep it as immutable as possible.</p> <p>From our original lens function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fileLens <span class="token operator">=</span> <span class="token function">iso</span><span class="token punctuation">(</span>
    readFileSync<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> originalData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'savedgame.json'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">||</span> data
<span class="token punctuation">)</span>
</code></pre></div><p>Let's utilize the 2nd parameter of our lens setter, the <code>originalData</code> which is the filename you passed in to read, <code>savedgame.json</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> uuidv4 <span class="token keyword">from</span> <span class="token string">'uuid/v4'</span>
<span class="token operator">...</span>
    <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> originalData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> filename <span class="token operator">=</span> 
            originalData
            <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.json'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> dataJSON <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">const</span> newFilename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dataJSON<span class="token punctuation">.</span>saveDate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span>
        <span class="token function">writeFileSync</span><span class="token punctuation">(</span>newFilename<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newFilename
    <span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>Nice, now each time we run her, we'll get a new filename generated and written to, using our template read-only, even with date hacking:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> updatedString <span class="token operator">=</span> <span class="token keyword">set</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span>readAndParseLens<span class="token punctuation">)</span><span class="token punctuation">.</span>saveDate<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'savedgame.json'</span><span class="token punctuation">)</span>
<span class="token comment">// savedgame_2018-11-26T00:21:47.141Z_26ca739b-7e86-4a4d-9363-f63f8e3828e6.json</span>
</code></pre></div><p>And the data inside:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;saveDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-11-26T00:21:47.141Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;map&quot;</span><span class="token operator">:</span> <span class="token string">&quot;overworld&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chapter&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    ...
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/real-world-functional-programming-book/part7/composing_lenses.html" class="prev">Composing Lenses</a></span> <span class="next"><a href="/real-world-functional-programming-book/part8/debugging.html">Debugging</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/real-world-functional-programming-book/assets/js/app.ad1bfc28.js" defer></script><script src="/real-world-functional-programming-book/assets/js/2.774c5d42.js" defer></script><script src="/real-world-functional-programming-book/assets/js/51.505f0293.js" defer></script>
  </body>
</html>
