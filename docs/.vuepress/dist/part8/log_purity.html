<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Log Purity</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css" as="style"><link rel="preload" href="/real-world-functional-programming-book/assets/js/app.4ecaf7cf.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/2.6da8cf3d.js" as="script"><link rel="preload" href="/real-world-functional-programming-book/assets/js/62.0d8a9263.js" as="script"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/10.94dd7f8c.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/11.698c5c4f.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/12.192a3ae6.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/13.8386adfa.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/14.25c778d2.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/15.62d54e5a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/16.8f2a7f1e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/17.749ab795.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/18.ec23f3ec.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/19.9ba81683.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/20.70969485.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/21.7bc06d56.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/22.dd9d45d7.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/23.f2ad21f6.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/24.80f0959b.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/25.6e62b877.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/26.bec311ec.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/27.110f94a9.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/28.829fb020.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/29.f5b667c7.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/3.51c6a686.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/30.bb7984c5.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/31.9b135bc8.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/32.4c26d247.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/33.5c022cb2.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/34.b4468fe6.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/35.a6519809.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/36.7dcb1e29.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/37.3980ad09.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/38.2eece47a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/39.204af450.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/4.80637c28.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/40.4224b6ca.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/41.47e1ccf5.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/42.ef4aaae1.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/43.927896fc.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/44.0e25a484.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/45.be50f1de.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/46.a6b52ac4.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/47.c9bcfbeb.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/48.9e11dca4.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/49.622efaaa.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/5.dd0514ea.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/50.07cb6d56.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/51.256e2d8e.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/52.a61ac66a.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/53.38837102.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/54.65632715.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/55.7558152f.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/56.632c19bc.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/57.44da2b00.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/58.5eeb983d.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/59.df5acc69.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/6.cd1d47c7.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/60.d35389d5.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/61.309602f9.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/63.bc1b30ad.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/64.c2cc4933.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/65.7d2bfbda.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/66.c2ec34a8.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/7.603220b3.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/8.74213919.js"><link rel="prefetch" href="/real-world-functional-programming-book/assets/js/9.997a717b.js">
    <link rel="stylesheet" href="/real-world-functional-programming-book/assets/css/0.styles.dda700b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/real-world-functional-programming-book/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/real-world-functional-programming-book/" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part1/" class="sidebar-heading clickable"><span>Part 1: Pure Functions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part2/" class="sidebar-heading clickable"><span>Part 2: Getting and Setting Data</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part3/" class="sidebar-heading clickable"><span>Part 3: List Comprehensions</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part4/" class="sidebar-heading clickable"><span>Part 4: Basic Function Composition</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part5/" class="sidebar-heading clickable"><span>Part 5: Curry and Partial Applications</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part6/" class="sidebar-heading clickable"><span>Part 6: Algebraic Data Types</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part7/" class="sidebar-heading clickable"><span>Part 7: Optics</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part8/" class="sidebar-heading clickable router-link-active open"><span>Part 8: Debugging</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/real-world-functional-programming-book/part8/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/real-world-functional-programming-book/part8/log_purity.html" class="active sidebar-link">Log Purity</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part8/log_purity.html#logging-purity-side-effects" class="sidebar-link">Logging Purity &amp; Side Effects</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part8/log_purity.html#logging-configurations" class="sidebar-link">Logging Configurations</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part8/log_purity.html#streams-and-exponential-side-effects" class="sidebar-link">Streams and Exponential Side Effects</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part8/log_purity.html#minimum-logging-side-effects" class="sidebar-link">Minimum Logging Side Effects</a></li><li class="sidebar-sub-header"><a href="/real-world-functional-programming-book/part8/log_purity.html#conclusions" class="sidebar-link">Conclusions</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/real-world-functional-programming-book/part9/" class="sidebar-heading clickable"><span>Part 9: Testing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="log-purity"><a href="#log-purity" class="header-anchor">#</a> Log Purity</h1> <p><strong>Warning</strong>: The following is considered ivory tower territory.</p> <p>Many Functional programmers who work on feature teams (shipping software non-developer users use) believe that purity of logging is not worth it. They have a pragmatic view that side effects I outline here are not a big deal, and their ease of use and debugging &amp; monitoring gains far outweigh the risk of unknown side effects.</p> <p>That said, this book is about real world programming, and while the real world requires you as a programmer to make tough calls for the sake of pragmatism, like <a href="https://en.wikipedia.org/wiki/George_S._Patton" target="_blank" rel="noopener noreferrer">Patton<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> said:</p> <blockquote><p>Take calculated risks. That is quite different from being rash.</p></blockquote> <p>You need to be aware of the potential side effects that loggers can have before you write off their side effects as nothing to worry about.</p> <h2 id="logging-purity-side-effects"><a href="#logging-purity-side-effects" class="header-anchor">#</a> Logging Purity &amp; Side Effects</h2> <p>In production applications, especially the back-end, you'll use more sophisticated loggers. Logging has side effects. For example, <code>console.log</code> is noop in that it doesn't return a value:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> result <span class="token operator">=</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;yo&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><p>Now, while it doesn't technically have a side effect in JavaScript, it DOES have a side effect in the system it's running on. The console will output to standard out (stdout). This is a stream of text that the operating system, typically <code>syslog</code> on Unix/Linux based systems will manage and aggregate. Effectively your <code>console.log</code> is pushing text into this global text area. This is compounded when using Docker Containers or Serverless when you have distributed systems.</p> <p>If you are running Docker containers on Amazon's <a href="https://aws.amazon.com/ecs/" target="_blank" rel="noopener noreferrer">Elastic Container Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (ECS), for example, you my have 3 of the same containers running at the same time, whether for scaling purposes or for each availability zone or both. When a <code>console.log</code> is run, all 3 are outputting to Docker logs, and in turn those are pushed to Amazon's <a href="https://aws.amazon.com/cloudwatch/" target="_blank" rel="noopener noreferrer">CloudWatch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or something like <a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Same thing for running multiple <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noopener noreferrer">Lambda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> functions at the same time; same code, but different instances logging to the same place.</p> <p>You or your Ops team may have alarms setup to use these logs to help monitor the health of your infrastructure. Some of these alarms may be automated to destroy unhealthy infrastructure, and create new servers, send monitoring emails, send text messages to your team when infrastructure appears unhealthy, etc.</p> <p><code>console.log</code>: Destroying and recreating infrastructure as well as sending emails to Ops and text messages to your boss.</p> <p>As you can see, those are some huge side effects from a log.</p> <h2 id="logging-configurations"><a href="#logging-configurations" class="header-anchor">#</a> Logging Configurations</h2> <p>Loggers often have a variety of various configurations and outputs as well. For example, many log parsers expect JSON, and each log message in a single line. Those kind of logs are not really useable for local development so you'll turn developer friendly formatting on, like <code>prettyPrint</code> for <a href="https://github.com/pinojs/pino" target="_blank" rel="noopener noreferrer">pino<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> pino <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pino'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">pino</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  prettyPrint<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Traditionally, you'd use something like <a href="https://github.com/lorenwest/node-config" target="_blank" rel="noopener noreferrer">config<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to determine if you're in a production environment.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">...</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">pino</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  prettyPrint<span class="token punctuation">:</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'prod'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Flipping a <code>Boolean</code> switch is a mutation with side effects. A more pure way is to create 2 different loggers; one for development/qa, and one for production.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getDevLogger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">pino</span><span class="token punctuation">(</span><span class="token punctuation">{</span> prettyPrint<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">getProdLogger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">pino</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="streams-and-exponential-side-effects"><a href="#streams-and-exponential-side-effects" class="header-anchor">#</a> Streams and Exponential Side Effects</h2> <p>Many loggers do more than just shuttle text. Some will take your <code>thing.logThis('message')</code> and send that same messages to multiple places in multiple formats. For example, the <a href="https://github.com/trentm/node-bunyan" target="_blank" rel="noopener noreferrer">Bunyan logger<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> allows you to create streams in the construction of the logger:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> log <span class="token operator">=</span> bunyan<span class="token punctuation">.</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'myapp'</span><span class="token punctuation">,</span>
    streams<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        level<span class="token punctuation">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
        stream<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdout
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        level<span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> <span class="token string">'/var/tmp/myapp-error.log'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        level<span class="token punctuation">:</span> <span class="token string">'warn'</span><span class="token punctuation">,</span>
        stream<span class="token punctuation">:</span> kafkaStream
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Now whenever we do a <code>log.warn('oh n0es')</code>, it'll go to standard out, to a local text file, and to a <a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Kafka<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> stream for auditing purposes. As above, these may change based on environment. These are also most likely going to have side effects, specifically writing to a file and sending a socket message with acknowledgement on a Kafka stream.</p> <h2 id="minimum-logging-side-effects"><a href="#minimum-logging-side-effects" class="header-anchor">#</a> Minimum Logging Side Effects</h2> <p>How do you use those logger instances, though? In most dynamic languages, you can use those as closures or globals and even the Clojure developers consider that acceptable. However, you've seen the side effects loggers can have: infrastructure changes, broken log/monitoring systems, file writing and sockets, oh my. I deployed our API code in prod with Pino's <code>prettyPrint</code> set to true, and it basically made the logs in ELK impossible to read. This meant if we had a production issue, I'd have no idea why by using the logs and would have to look elsewhere. Huge deal.</p> <p>If you follow the Kent Beck model of TDD, you're probably also fine with these side effects being triggered in your unit tests instead of stubbing/mocking them. If, on the other hand you're still exploring an API's implementation details, learning, or tracking down a strange bug in your audit system, bringing as much purity to your logging layer can really put a capstone on the purity of your code base.</p> <p>It's also a royal pain in the neck, more so than <a href="/real-world-functional-programming-book/part8/part7/">total functions</a>. As soon as the implementation of a child function changes, you'll need to ensure you include a logger for it in the function parameters.</p> <p>For example, here is a function that gets a user's email address and includes the logger as the first parameter:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getUserInformation</span> <span class="token operator">=</span> <span class="token parameter">logger</span> <span class="token operator">=&gt;</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token parameter">userID</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">success<span class="token punctuation">,</span> failure</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Getting user information, userID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Get user information result: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Here is a <code>sendEmail</code> function that utilizes it:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">getProdLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">sendEmail</span> <span class="token operator">=</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token parameter">userID</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sendEmail for userID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token function">getUserInformation</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> request<span class="token punctuation">,</span> userID<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token function">sendActualEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Notice the <code>getUserInformation</code> function to be pure takes in 3 parameters: the logger, request, and the userID. However, the <code>sendEmail</code> takes a pragmatic approach and uses the <code>logger</code> as a closure referenced variable... effectively having side effects. If you're being a purist, you have to change the <code>sendEmail</code> function signature to include the logger:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">sendEmail</span> <span class="token operator">=</span> <span class="token parameter">logger</span> <span class="token operator">=&gt;</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token parameter">userID</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre></div><p>Hopefully if it's a public method, you've only exposed the partial application to prevent the changing of a public API:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    sendEmail<span class="token punctuation">:</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Changing it too:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    sendEmail<span class="token punctuation">:</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="conclusions"><a href="#conclusions" class="header-anchor">#</a> Conclusions</h2> <p>From my experience in the industry and talking to a variety of Haskell, Elm, PureScript, and Clojure programmers, with the exclusion of Haskell, most take a pragmatic approach to logging:</p> <ul><li>they don't unit test their production logger, they just use it</li> <li>they don't mind it being a global/closure referenced variable</li> <li>they don't mind it having side effects even in their unit tests</li></ul> <p>Just be aware OF those side effects to minimize the bad parts where you can, if they're applicable to you.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/real-world-functional-programming-book/part8/debugging.html" class="prev">Debugging</a></span> <span class="next"><a href="/real-world-functional-programming-book/part9/testing.html">Test Driven Development</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/real-world-functional-programming-book/assets/js/app.4ecaf7cf.js" defer></script><script src="/real-world-functional-programming-book/assets/js/2.6da8cf3d.js" defer></script><script src="/real-world-functional-programming-book/assets/js/62.0d8a9263.js" defer></script>
  </body>
</html>
